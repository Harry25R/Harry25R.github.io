import{getImpactData as t}from"./data.js";import{prefersReducedMotion as e}from"./utils.js";export async function initChart(a=document){const i=a.querySelector("[data-impact-chart]");if(!i)return;const l=await t();if(!l||0===l.length)return void(i.innerHTML='<p class="text-sm text-slate-600 dark:text-slate-300">Impact data unavailable.</p>');const s=40,n=Math.min(...l.map(t=>t.value)),o=Math.max(...l.map(t=>t.value))-n||1,r=l.map(t=>new Date(`${t.date}T00:00:00`).getTime()),c=Math.min(...r),d=Math.max(...r)-c||1,m=l.map(t=>({x:s+(new Date(`${t.date}T00:00:00`).getTime()-c)/d*560,y:200-(t.value-n)/o*160,label:t.label,value:t.value,date:t.date})),h=m.map((t,e)=>`${0===e?"M":"L"}${t.x.toFixed(1)},${t.y.toFixed(1)}`).join(" "),p=m.map(t=>`<circle cx="${t.x.toFixed(1)}" cy="${t.y.toFixed(1)}" r="5" fill="rgb(37,99,235)" tabindex="0">\n        <title>${t.label} (${t.date}): AUROC ${t.value}</title>\n      </circle>`).join("");if(i.innerHTML=`\n    <svg viewBox="0 0 640 240" role="img" aria-labelledby="impact-title impact-desc" class="h-full w-full">\n      <title id="impact-title">Impact over time</title>\n      <desc id="impact-desc">Model AUROC progression from ${l[0].date} to ${l[l.length-1].date}.</desc>\n      <rect x="40" y="40" width="560" height="160" class="fill-slate-100 dark:fill-slate-900" rx="12" />\n      <path d="${h}" fill="none" stroke="rgb(37, 99, 235)" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />\n      ${p}\n    </svg>\n  `,!e.matches){const t=i.querySelector("svg path");t&&(t.style.strokeDasharray=t.getTotalLength(),t.style.strokeDashoffset=t.getTotalLength(),t.style.transition="stroke-dashoffset 1.2s ease-out",requestAnimationFrame(()=>{t.style.strokeDashoffset="0"}))}}